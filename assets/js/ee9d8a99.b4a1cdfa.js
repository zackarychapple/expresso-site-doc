"use strict";(self.webpackChunkclassic=self.webpackChunkclassic||[]).push([[121],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>h});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var i=r.createContext({}),p=function(e){var t=r.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},c=function(e){var t=p(e.components);return r.createElement(i.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,i=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=p(n),m=a,h=d["".concat(i,".").concat(m)]||d[m]||u[m]||o;return n?r.createElement(h,s(s({ref:t},c),{},{components:n})):r.createElement(h,s({ref:t},c))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,s=new Array(o);s[0]=m;var l={};for(var i in t)hasOwnProperty.call(t,i)&&(l[i]=t[i]);l.originalType=e,l[d]="string"==typeof e?e:a,s[1]=l;for(var p=2;p<o;p++)s[p]=n[p];return r.createElement.apply(null,s)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},7903:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>s,default:()=>u,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var r=n(7462),a=(n(7294),n(3905));const o={sidebar_position:5},s="Controllers",l={unversionedId:"overview/controller",id:"overview/controller",title:"Controllers",description:"Controllers act as the primary interface between the client and server in ExpressoTS applications. They handle incoming requests, validate payloads against Input DTO, and emit responses in the DTO pattern. In essence, controllers bridge the communication between clients and service layers, also known as use-cases.",source:"@site/docs/overview/controller.md",sourceDirName:"overview",slug:"/overview/controller",permalink:"/docs/overview/controller",draft:!1,tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"Modules",permalink:"/docs/overview/module"},next:{title:"Use Cases",permalink:"/docs/overview/usecase"}},i={},p=[{value:"DTO pattern",id:"dto-pattern",level:2},{value:"DTO example",id:"dto-example",level:3},{value:"Controller Class",id:"controller-class",level:2},{value:"BaseController Class",id:"basecontroller-class",level:2},{value:"Controller scope",id:"controller-scope",level:2},{value:"Controller decorators",id:"controller-decorators",level:2},{value:"HTTP methods decorators",id:"http-methods-decorators",level:3},{value:"Parameter decorators",id:"parameter-decorators",level:3},{value:"A MVC approach",id:"a-mvc-approach",level:2},{value:"Support the project",id:"support-the-project",level:2}],c={toc:p},d="wrapper";function u(e){let{components:t,...n}=e;return(0,a.kt)(d,(0,r.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"controllers"},"Controllers"),(0,a.kt)("p",null,"Controllers act as the primary interface between the client and server in ExpressoTS applications. They handle incoming requests, validate payloads against Input DTO, and emit responses in the DTO pattern. In essence, controllers bridge the communication between clients and service layers, also known as use-cases."),(0,a.kt)("h2",{id:"dto-pattern"},"DTO pattern"),(0,a.kt)("p",null,"Data Transfer Object (DTO) is a commonly used design pattern that standardizes data formats for communication between different application layers, including client-server or server modules. DTO serves as an interface for data exchange, ensuring clear and standardized structures for input and output data. By separating business logic from communication logic, it helps to reduce application complexity and decouple different layers."),(0,a.kt)("p",null,"Using DTOs can improve application performance and scalability by reducing the data transfer between the client and server and providing more efficient ways to process and handle data within the application."),(0,a.kt)("h3",{id:"dto-example"},"DTO example"),(0,a.kt)("p",null,"For example, imagine a user registration scenario where name, email, and password are collected, and ID is auto-generated. The user object DTO for Input and Response could have possible formats, as shown below:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},'// UserCreateInputDTO\ninterface UserCreateInputDTO {\n  name: string;\n  email: string;\n  password: string;\n}\n\n// UserCreateResponseDTO\ninterface UserCreateResponseDTO {\n  id: string;\n  name: string;\n  status: string;\n}\n\n// Payload json format\n{\n  "name": string,\n  "email": string,\n  "password": string\n}\n')),(0,a.kt)("p",null,"Having two different DTO formats is essential in this case because while registering a user, we don't want to return the password to the client due to security concerns. Therefore, we created a different DTO for the response, adding a complementary field called status, where a message is typically sent to the client, indicating that the user was created successfully."),(0,a.kt)("p",null,"As a result, DTOs help to segregate and filter the data being sent to the client, reducing the amount of data processed by the application."),(0,a.kt)("h2",{id:"controller-class"},"Controller Class"),(0,a.kt)("p",null,"The controller class in ExpressoTS represents the endpoint that you want to create for your application. You can define the route and HTTP method for the controller by using the ",(0,a.kt)("inlineCode",{parentName:"p"},"@controller()")," decorator from the ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/inversify/inversify-express-utils"},"Inversify Express Utils package"),"."),(0,a.kt)("p",null,"Each controller class contains a single method called ",(0,a.kt)("inlineCode",{parentName:"p"},"execute()")," that handles the request and sends the response. This method is annotated with the ",(0,a.kt)("strong",{parentName:"p"},(0,a.kt)("a",{parentName:"strong",href:"/docs/overview/decorators"},"@httpMethods()"))," decorators. Additionally, you can also annotate the parameters of the ",(0,a.kt)("inlineCode",{parentName:"p"},"execute()")," method."),(0,a.kt)("p",null,"Here is an example of a simple ExpressoTS controller class:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},'@controller("/")\nclass AppController {\n  \n  @httpGet("/")\n  execute(@response() res: any) {\n    return res.send("Hello from ExpressoTS!");\n  }\n}\n')),(0,a.kt)("admonition",{type:"info"},(0,a.kt)("p",{parentName:"admonition"},"In the AppController class above we are using res as any ",(0,a.kt)("inlineCode",{parentName:"p"},"res:any")," but you can definitely use the ",(0,a.kt)("inlineCode",{parentName:"p"},"res:Response")," type from the ",(0,a.kt)("inlineCode",{parentName:"p"},"express")," package as we expose its types. This will allow you to make use of all the methods that the ",(0,a.kt)("strong",{parentName:"p"},(0,a.kt)("a",{parentName:"strong",href:"https://expressjs.com/en/4x/api.html#res"},"Response"))," type offers.")),(0,a.kt)("h2",{id:"basecontroller-class"},"BaseController Class"),(0,a.kt)("p",null,"We also power a controller class with the ",(0,a.kt)("inlineCode",{parentName:"p"},"BaseController")," class that offers in the constructor a parameter that the developer can indicate what service or domain he is currently building. This helps the log system throw errors with more information about the context of the error and where the error occurred."),(0,a.kt)("p",null,"Another advantage of using the ",(0,a.kt)("inlineCode",{parentName:"p"},"BaseController")," class is that it offers a method in two different versions async and sync, which is the ",(0,a.kt)("inlineCode",{parentName:"p"},"callUseCase() or callUseCaseAsync()"),"."),(0,a.kt)("p",null,"These methods reinforce the idea of one use case per controller, and they are responsible for calling the use case that will implement the business logic of the controller."),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"The callUseCase methods, available in both synchronous and asynchronous versions, are well-suited for returning status and JSON responses to clients, as the users just need to pass the useCase return, res:Response, and statusCode.")),(0,a.kt)("p",null,"The signature of the ",(0,a.kt)("inlineCode",{parentName:"p"},"callUseCase")," method:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"callUseCase(useCase: any, res: any, successStatusCode: number);\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"useCase"),": The use case that will be called. This use case is injected in the controller constructor."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"res"),": The response object from the express request."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"successStatusCode"),": The status code that will be sent to the client if the use case is executed successfully. Please see the ",(0,a.kt)("strong",{parentName:"li"},(0,a.kt)("a",{parentName:"strong",href:"/docs/overview/status-code"},"Http Status Code"))," type for more information.")),(0,a.kt)("p",null,"The default response:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"return res.status(successStatusCode).json(dataReturn);\n")),(0,a.kt)("p",null,"A more complete example of a controller class inheriting from the ",(0,a.kt)("strong",{parentName:"p"},"BaseController")," class is shown below:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},'@controller("/")\nclass AppController extends BaseController {\n  constructor(private appUseCase: AppUseCase) {\n    super("app-controller");\n  }\n\n  @httpGet("/")\n  execute(@response() res: any): IAppResponseDTO {\n    return this.callUseCase(this.appUseCase.execute(),\n      res,\n      StatusCode.OK\n    );\n  }\n}\n')),(0,a.kt)("h2",{id:"controller-scope"},"Controller scope"),(0,a.kt)("p",null,"The default scope of a controller is ",(0,a.kt)("inlineCode",{parentName:"p"},"Request"),", as it is inherited from the ",(0,a.kt)("inlineCode",{parentName:"p"},"AppContainer")," and default ",(0,a.kt)("inlineCode",{parentName:"p"},"Module")," class scope. However you can override the scope of a controller by using the ",(0,a.kt)("inlineCode",{parentName:"p"},"@scope()")," decorator. This decorator accepts the same BindingScopeEnum enum values."),(0,a.kt)("admonition",{type:"info"},(0,a.kt)("p",{parentName:"admonition"},"If you define the module scope you can not override it in a specific controller by using the ",(0,a.kt)("inlineCode",{parentName:"p"},"@scope")," decorator.\nThe ",(0,a.kt)("inlineCode",{parentName:"p"},"@scope")," decorator can only be used in specific controllers if the module scope is not defined.")),(0,a.kt)("p",null,"Here is an example of usage:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},'@scope(BindingScopeEnum.Singleton)\n@controller("/")\nclass CreateUserController extends BaseController { }\n')),(0,a.kt)("p",null,"The controller above will be scoped as ",(0,a.kt)("inlineCode",{parentName:"p"},"Singleton")," and will be shared across all requests."),(0,a.kt)("h2",{id:"controller-decorators"},"Controller decorators"),(0,a.kt)("p",null,"HTTP methods and parameters decorators are a set of annotations used in ExpressoTS applications to define the routing and request handling for HTTP requests. Using the decorators listed below can simplify the routing and handling of HTTP requests in ExpressoTS applications, and make the code more readable and maintainable."),(0,a.kt)("h3",{id:"http-methods-decorators"},"HTTP methods decorators"),(0,a.kt)("p",null,"Here's a list of all available ",(0,a.kt)("inlineCode",{parentName:"p"},"@httpMethods()")," decorators in ExpressoTS, along with their description and usage:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Decorator"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"),(0,a.kt)("th",{parentName:"tr",align:null},"Usage"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"@httpGet"),(0,a.kt)("td",{parentName:"tr",align:null},"Binds a controller method to a GET HTTP verb."),(0,a.kt)("td",{parentName:"tr",align:null},'@httpGet("/path")')),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"@httpPost"),(0,a.kt)("td",{parentName:"tr",align:null},"Binds a controller method to a POST HTTP verb."),(0,a.kt)("td",{parentName:"tr",align:null},'@httpPost("/path")')),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"@httpPut"),(0,a.kt)("td",{parentName:"tr",align:null},"Binds a controller method to a PUT HTTP verb."),(0,a.kt)("td",{parentName:"tr",align:null},'@httpPut("/path")')),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"@httpPatch"),(0,a.kt)("td",{parentName:"tr",align:null},"Binds a controller method to a PATCH HTTP verb."),(0,a.kt)("td",{parentName:"tr",align:null},'@httpPatch("/path")')),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"@httpHead"),(0,a.kt)("td",{parentName:"tr",align:null},"Binds a controller method to a HEAD HTTP verb."),(0,a.kt)("td",{parentName:"tr",align:null},'@httpHead("/path")')),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"@httpDelete"),(0,a.kt)("td",{parentName:"tr",align:null},"Binds a controller method to a DELETE HTTP verb."),(0,a.kt)("td",{parentName:"tr",align:null},'@httpDelete("/path")')),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"@httpMethod"),(0,a.kt)("td",{parentName:"tr",align:null},"Binds a controller method to a specified HTTP verb."),(0,a.kt)("td",{parentName:"tr",align:null},'@httpMethod("verb", "/path")')))),(0,a.kt)("h3",{id:"parameter-decorators"},"Parameter decorators"),(0,a.kt)("p",null,"Here's a list of all available parameter decorators in ExpressoTS, along with their description and usage:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Decorator"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"),(0,a.kt)("th",{parentName:"tr",align:null},"Usage"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"@request()"),(0,a.kt)("td",{parentName:"tr",align:null},"Injects the Express Request object."),(0,a.kt)("td",{parentName:"tr",align:null},"execute(@request() req: Request)")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"@response()"),(0,a.kt)("td",{parentName:"tr",align:null},"Injects the Express Response object."),(0,a.kt)("td",{parentName:"tr",align:null},"execute(@response() res: Response)")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"@requestParam(paramName?: string)"),(0,a.kt)("td",{parentName:"tr",align:null},"Injects a parameter from the request URL path."),(0,a.kt)("td",{parentName:"tr",align:null},"execute(@requestParam('id') id: string)")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"@queryParam(paramName?: string)"),(0,a.kt)("td",{parentName:"tr",align:null},"Injects a parameter from the request URL query string."),(0,a.kt)("td",{parentName:"tr",align:null},"execute(@queryParam('searchTerm') searchTerm: string)")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"@requestBody()"),(0,a.kt)("td",{parentName:"tr",align:null},"Injects the request body payload."),(0,a.kt)("td",{parentName:"tr",align:null},"execute(@requestBody() body: MyDTO)")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"@requestHeaders(headerName?: string)"),(0,a.kt)("td",{parentName:"tr",align:null},"Injects a header from the request headers."),(0,a.kt)("td",{parentName:"tr",align:null},"execute(@requestHeaders('authorization') auth: string)")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"@cookies(cookieName?: string)"),(0,a.kt)("td",{parentName:"tr",align:null},"Injects a cookie from the request cookies."),(0,a.kt)("td",{parentName:"tr",align:null},"execute(@cookies('session') session: string)")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"@next()"),(0,a.kt)("td",{parentName:"tr",align:null},"Injects the Express NextFunction object."),(0,a.kt)("td",{parentName:"tr",align:null},"execute(@next() next: NextFunction)")))),(0,a.kt)("h2",{id:"a-mvc-approach"},"A MVC approach"),(0,a.kt)("p",null,"Despite in the opinionated template we recommend one controller and one use case per route, you can definitely use the MVC approach or any other pattern you want. For this we recommend the use of a ",(0,a.kt)("inlineCode",{parentName:"p"},"non-opinionated")," template, in which the developer have freedom to customize his application."),(0,a.kt)("p",null,"Here is an example of use MVC approach, which contains a single controller class that handles the request for a product resource:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},'@controller("/product")\nclass ProductController {\n  @httpPost("/")\n  create(@response() res: any) {\n    return res.status(201).json({ message: "Product created" });\n  }\n\n  @httpGet("/")\n  list(@response() res: any) {\n    return res.status(200).json({ message: "Product listed" });\n  }\n\n  @httpGet("/:id")\n  get(@response() res: any) {\n    return res.status(200).json({ message: "Product get" });\n  }\n\n  @httpPatch("/:id")\n  update(@response() res: any) {\n    return res.status(200).json({ message: "Product updated" });\n  }\n\n  @httpDelete("/:id")\n  delete(@response() res: any) {\n    return res.status(200).json({ message: "Product deleted" });\n  }\n}\n')),(0,a.kt)("hr",null),(0,a.kt)("h2",{id:"support-the-project"},"Support the project"),(0,a.kt)("p",null,"ExpressoTS is an MIT-licensed open source project. It's an independent project with ongoing development made possible thanks to your support. If you'd like to help, please consider:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Become a sponsor on ",(0,a.kt)("strong",{parentName:"li"},(0,a.kt)("a",{parentName:"strong",href:"https://github.com/sponsors/expressots"},"Sponsor no GitHub"))),(0,a.kt)("li",{parentName:"ul"},"Follow the ",(0,a.kt)("strong",{parentName:"li"},(0,a.kt)("a",{parentName:"strong",href:"https://github.com/expressots"},"organization"))," on GitHub and Star \u2b50 the project"),(0,a.kt)("li",{parentName:"ul"},"Subscribe to the Twitch channel: ",(0,a.kt)("strong",{parentName:"li"},(0,a.kt)("a",{parentName:"strong",href:"https://www.twitch.tv/richardzampieri"},"Richard Zampieri"))),(0,a.kt)("li",{parentName:"ul"},"Join our ",(0,a.kt)("strong",{parentName:"li"},(0,a.kt)("a",{parentName:"strong",href:"https://discord.com/invite/PyPJfGK"},"Discord"))),(0,a.kt)("li",{parentName:"ul"},"Contribute submitting ",(0,a.kt)("strong",{parentName:"li"},(0,a.kt)("a",{parentName:"strong",href:"https://github.com/expressots/expressots/issues/new/choose"},"issues and pull requests"))),(0,a.kt)("li",{parentName:"ul"},"Share the project with your friends and colleagues")))}u.isMDXComponent=!0}}]);